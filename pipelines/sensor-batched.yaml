# Pipeline: IoT Sensor File to Batched Output
# Reads sensor JSONL from file, batches, writes to output files
#
# Usage:
#   # Generate data first
#   ./sensor-gen/sensor-gen -d 60s -o /tmp/sensors.jsonl
#
#   # Process it
#   INPUT_FILE=/tmp/sensors.jsonl expanso-edge run pipelines/sensor-batched.yaml
#
# Configuration:
#   - INPUT_FILE: Path to sensor JSONL file (default: output.jsonl)
#   - BATCH_SIZE: Records per batch file (default: 1000)
#   - BATCH_PERIOD: Max time before flushing batch (default: 10s)
#   - OUTPUT_DIR: Directory for batch files (default: ./output)

input:
  file:
    paths:
      - "${INPUT_FILE:output.jsonl}"
    scanner:
      lines: {}

output:
  file:
    path: '${OUTPUT_DIR:./output}/batch_${! timestamp_unix_nano() }.json'
    codec: all-bytes
  batching:
    count: ${BATCH_SIZE:1000}
    period: "${BATCH_PERIOD:10s}"
    processors:
      - archive:
          format: json_array
